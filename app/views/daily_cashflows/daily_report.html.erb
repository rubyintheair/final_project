<h1>Welcome to Daily Report</h1>
<% if current_user.daily_cashflows.count >= 1 %>
  <h1>These graph display the data of: <%= @last_day %></h1>
  
  <div class="columns">
    <div class="column">
      <div class="card">
        <div class="card-header">
          <div class="card-header-title">
          Income VS outcome in VND currency 
          </div>
        </div>
        <%= pie_chart @last_day_cashflows_vnd, width: "550px", height: "200px", download: true %>
      </div>
    </div>

    <div class="column ">
      <div class="card">
        <div class="card-header">
          <div class="card-header-title">
          Income VS outcome in USD currency
          </div>
        </div>
        <%= pie_chart @last_day_cashflows_usd, width: "550px", height: "200px", download: true %>
      </div>
    </div>
  </div>

  <br>

  
  <div class="columns">
    <div class="column">
      <div class="card">
        <div class="card-header" style="margin-bottom: 15px">
          <div class="card-header-title">
            Income in VND currency of this week
          </div>
        </div>
        <%= line_chart @this_week_vnd_income_cashflows, width: "550px", height: "300px"%>
      </div>
    </div>

    <div class="column">
      <div class="card">
        <div class="card-header" style="margin-bottom: 15px">
          <div class="card-header-title">
            Outcome in VND currency of this week
          </div>
        </div>
        <%= line_chart @this_week_vnd_outcome_cashflows, colors: ["pink", "#999"], width: "500px", height: "300px" %>
      </div>
    </div>
  </div>

  <div class="columns">
    <div class="column">
      <div class="card">
        <div class="card-header" style="margin-bottom: 15px">
          <div class="card-header-title">
            Income in USD currency of this week
          </div>
        </div>
        <%= line_chart @this_week_usd_income_cashflows, width: "550px", height: "300px"%>
      </div>
    </div>

    <div class="column">
      <div class="card">
        <div class="card-header" style="margin-bottom: 15px">
          <div class="card-header-title">
            Outcome in USD currency of this week
          </div>
        </div>
        <%= line_chart @this_week_usd_outcome_cashflows, colors: ["pink", "#999"], width: "500px", height: "300px" %>
      </div>
    </div>
  </div>

  <div class="columns">
    <div class="column">
      <div class="card">
        <div class="card-header" style="margin-bottom: 15px">
          <div class="card-header-title">
            Income in VND based on purpose
          </div>
        </div>
        <%= pie_chart @last_day_vnd_income_purpose, width: "550px", height: "220px", download: true%>
      </div>
    </div>

    <div class="column">
      <div class="card">
        <div class="card-header" style="margin-bottom: 15px">
          <div class="card-header-title">
            Outcome in VND based on purpose
          </div>
        </div>
        <%= pie_chart @last_day_vnd_outcome_purpose, width: "550px", height: "220px", download: true %>
      </div>
    </div>
  </div>

  <div class="columns">
    <div class="column">
      <div class="card">
        <div class="card-header" style="margin-bottom: 15px">
          <div class="card-header-title">
            Income in USD based on purpose
          </div>
        </div>
        <%= pie_chart @last_day_usd_income_purpose, width: "550px", height: "220px", download: true%>
      </div>
    </div>

    <div class="column">
      <div class="card">
        <div class="card-header" style="margin-bottom: 15px">
          <div class="card-header-title">
            Outcome in USD based on purpose
          </div>
        </div>
        <%= pie_chart @last_day_usd_outcome_purpose, width: "550px", height: "220px", download: true %>
      </div>
    </div>
  </div>


  
  
  
  <br>
  
  <h1>Report each transaction as excel file </h1>
  <%= render "display_by_attribute", {cashflows:@last_day_cashflows, total:  0, incomes:  0, outcomes:  0 }%>

  <table class="table is-bordered is-striped">
    <thead>
      <tr>
        <th>Currency</th>
        <% ["Income", "Outcome", "Income - Outcome", "Outcome - The largest purpose", "Outcome - The smallest purpose", "Income - The largest purpose", "Income - The smallest purpose"].each do |e| %>
          <th><%= e %></th>
        <% end %>
      </tr>
    </thead>
    <tbody>
      <% ["USD", "VND"].each_with_index do |currency, index| %>
        <tr>
          <td><%= currency %></td>
          <% if index == 0 %>
            <td><%= @last_day_usd_sum_by_day["Income"] || @last_day_usd_sum_by_day["Income"] = 0 %></td>
            <td><%= @last_day_usd_sum_by_day["Outcome"] || @last_day_usd_sum_by_day["Outcome"] = 0 %></td>
            <td><%= (@last_day_usd_sum_by_day["Income"] - @last_day_usd_sum_by_day["Outcome"]) %></td>
            
          <% elsif index == 1 %>
            <td><%= @last_day_vnd_sum_by_day["Income"] || @last_day_vnd_sum_by_day["Income"] = 0 %></td>
            <td><%= @last_day_vnd_sum_by_day["Outcome"] || @last_day_vnd_sum_by_day["Outcome"] = 0 %></td>
            <td><%= (@last_day_vnd_sum_by_day["Income"] - @last_day_vnd_sum_by_day["Outcome"] )%></td>
          <% end %>
        </tr>
      <% end %>
    </tbody>
  </table>
<% end %>